<!DOCTYPE HTML>

<html>
	<head>
	
	<script>
		equation = "0";
		isAnswer = true;
		function calc(eq) {
			var start = 0;
			if (eq.charAt(0) == '(') ++start;
			var end = eq.length - 1;
			if (eq.charAt(eq.length - 1) == ')') --end;
			var pos = start;
			var cnt = 0;
			for (; pos <= end; ++pos) {
				var ch = eq.charAt(pos);
				if (ch == '(') {
					++cnt;
					continue;
				}
				if (ch == ')') {
					--cnt;
					continue;
				}
				if (cnt > 0) continue;
				if (ch == '+' || ch == '-') break;
			}
			if (pos > end) {
				pos = start;
				cnt = 0;
				for (; pos <= end; ++pos) {
					var ch = eq.charAt(pos);
					if (ch == '(') {
						++cnt;
						continue;
					}
					if (ch == ')') {
						--cnt;
						continue;
					}
					if (cnt > 0) continue;
					if (ch == '*' || ch == '/') break;
				}
			}
			if (pos > end) {
				if (eq.substring(start, end + 1) == "") return NaN;
				else return Number(eq.substring(start, end + 1));
			}
			var tmp1 = calc(eq.substring(start, pos));
			var tmp2 = calc(eq.substring(pos + 1, end + 1));
			if (eq.charAt(pos) == '+') return tmp1 + tmp2;
			if (eq.charAt(pos) == '-') return tmp1 - tmp2;
			if (eq.charAt(pos) == '*') return tmp1 * tmp2;
			if (eq.charAt(pos) == '/') return tmp1 / tmp2;
		}
		
		function update() {
			if (equation == "Infinity" || equation == "NaN") equation = "Illegal input!";
			document.getElementById("t").innerHTML = equation;
		}
		
		function append(ch) {
			if (isAnswer) equation = "";
			equation += ch;
			isAnswer = false;
			update();
		}
		
		function clear() {
			equation = "0";
			isAnswer = true;
			update();
		}
		
		function backSpace() {
			if (isAnswer) equation = "0";
			else equation = equation.substring(0, equation.length - 1);
			if (equation.length == 0) {
				equation = "0";
				isAnswer = true;
			}
			else {
				isAnswer = false;
			}
			update();
		}
		
		function getAnswer() {
			var answer = calc(equation);
			equation = answer.toString();
			isAnswer = true;
			update();
		}
		
		function createButton(ch) {
			var buttonNode = document.createElement("button");
			buttonNode.type = "button";
			if (ch != '=' && ch != 'd' && ch != 'C') {
				buttonNode.onclick = function() {append(ch)};
			}
			else {
				if (ch == '=') buttonNode.onclick = function() {getAnswer()};
				if (ch == 'd') buttonNode.onclick = function() {backSpace()};
				if (ch == 'C') buttonNode.onclick = function() {clear()};
			}
			var textNode;
			if (ch == 'd')
				textNode = document.createTextNode("¡û");
			else
				textNode = document.createTextNode(ch);
			buttonNode.appendChild(textNode);
			equation = "0";
			isAnswer = true;
			return buttonNode;
		}
	</script>
	
	</head>
	<body>
		<table style = "border:4px CornFlowerBlue solid;" bgcolor = "LightSteelBlue">
			<tr>
				<th id = "t" bgcolor = "white" align = "right" colspan = "4"></th>
			</tr>
			<tr>
				<th id = "C"></th>
				<th id = "d"></th>
				<th id = "("></th>
				<th id = ")"></th>
			</tr>
			<tr>
				<th id = "1"></th>
				<th id = "2"></th>
				<th id = "3"></th>
				<th id = "+"></th>
			</tr>
			<tr>
				<th id = "4"></th>
				<th id = "5"></th>
				<th id = "6"></th>
				<th id = "-"></th>
			</tr>
			<tr>
				<th id = "7"></th>
				<th id = "8"></th>
				<th id = "9"></th>
				<th id = "*"></th>
			</tr>
			<tr>
				<th id = "0"></th>
				<th id = "."></th>
				<th id = "="></th>
				<th id = "/"></th>
			</tr>
		</table>
		
		<script>
			update();
			
			document.getElementById("C").appendChild(createButton("C"));
			document.getElementById("d").appendChild(createButton("d"));
			document.getElementById("(").appendChild(createButton("("));
			document.getElementById(")").appendChild(createButton(")"));
			document.getElementById("1").appendChild(createButton("1"));
			document.getElementById("2").appendChild(createButton("2"));
			document.getElementById("3").appendChild(createButton("3"));
			document.getElementById("+").appendChild(createButton("+"));
			document.getElementById("4").appendChild(createButton("4"));
			document.getElementById("5").appendChild(createButton("5"));
			document.getElementById("6").appendChild(createButton("6"));
			document.getElementById("-").appendChild(createButton("-"));
			document.getElementById("7").appendChild(createButton("7"));
			document.getElementById("8").appendChild(createButton("8"));
			document.getElementById("9").appendChild(createButton("9"));
			document.getElementById("*").appendChild(createButton("*"));
			document.getElementById("0").appendChild(createButton("0"));
			document.getElementById(".").appendChild(createButton("."));
			document.getElementById("=").appendChild(createButton("="));
			document.getElementById("/").appendChild(createButton("/"));
			
		</script>
	</body>
</html>